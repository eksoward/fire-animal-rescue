<!DOCTYPE html>
<html>
<head>
  <title>Fire Animal Rescue Response Oregon 2020</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, avenir next, avenir, helvetica neue, helvetica, Ubuntu, roboto, noto, segoe ui, arial, sans-serif;
      padding: 0;
      margin: 0;
    }
    body, html { min-height: 100%; }
    #map {
      position: absolute;
      top: 50px;
      left: 0;
      right: 0;
      bottom: 0;
    }
    #header {
      position: absolute;
      display: flex;
      align-items:center;
      padding-left:25px;
      height: 50px;
      top: 0;
      left: 0;
      right: 0;
      background: darkred;
      color: white;
    }

  </style>
</head>
<body>
<div id='header'>
  Fire Animal Rescue Response Oregon 2020
</div>

<div id='map'></div>

<script type='module'>
var map = L.map('map');

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

function popup(obj) {
  let elem = document.createElement('div');

  for (let k in obj) {
    const value = obj[k].trim();
    if (!value) continue;
    const h3 = elem.appendChild(document.createElement('h3'));
    const div = elem.appendChild(document.createElement('div'));
    h3.textContent = k;
    div.textContent = obj[k];
  }

  return elem;
}

map.fitBounds([
      [44.044167353572185,
      -124.07409667968749],
      [47.137424646293866,
      -118.41613769531249],
]);

const needHelpCluster = L.markerClusterGroup().addTo(map);
const haveRoomCluster = L.markerClusterGroup().addTo(map);
const canHelpCluster = L.markerClusterGroup().addTo(map);

L.control.layers(undefined, {
  "I need help": needHelpCluster,
  "I have room": haveRoomCluster,
  "I can help": canHelpCluster,
}).addTo(map);

fetch('/can_help.geojson').then(r => r.json()).then(can_help => {
    canHelpCluster.addLayers(L.geoJSON(can_help, {
        style: function (feature) {
            return {color: feature.properties.color};
        }
    }).eachLayer(function (layer) {
      layer.bindPopup(popup(layer.feature.properties));
    }));
})

fetch('/need_help.geojson').then(r => r.json()).then(need_help => {
    needHelpCluster.addLayers(L.geoJSON(need_help, {
        style: function (feature) {
            return {color: feature.properties.color};
        }
    }).eachLayer(function (layer) {
      layer.bindPopup(popup(layer.feature.properties));
    }));
});

fetch('/have_room.geojson').then(r => r.json()).then(have_room => {
  haveRoomCluster.addLayers(L.geoJSON(have_room, {
      style: function (feature) {
          return {color: feature.properties.color};
      }
  }).eachLayer(function (layer) {
    layer.bindPopup(popup(layer.feature.properties));
  }))
});

    
</script>

</body>
